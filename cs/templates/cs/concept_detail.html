{% extends 'cs/base.html' %}

{% block title %}{{ concept.title }}{% endblock %}

{% block content %}
  <h2>{{ concept.title }}</h2>

  {# Если для этой концепции загружено изображение, покажем его #}
  {% if concept.image %}
    <div style="margin-bottom: 1em;">
      <img src="{{ concept.image.url }}" alt="{{ concept.title }}" style="max-width:100%; height:auto;">
    </div>
  {% endif %}

  <p>Сложность: {{ concept.difficulty }}</p>
  {% if concept.field_of_study %}
    <p>Область науки: {{ concept.field_of_study.name }}</p>
  {% endif %}
  <div>
    {{ concept.description|linebreaks }}
  </div>

  {% if concept.tags.all %}
    <p>Теги:
      {% for tag in concept.tags.all %}
        <a href="{{ tag.get_absolute_url }}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
      {% endfor %}
    </p>
  {% endif %}

  <h3>Комментарии:</h3>
  {% if user.is_authenticated %}
    <form action="" method="post">
      {% csrf_token %}
      {{ comment_form.as_p }}
      <button type="submit">Отправить комментарий</button>
    </form>
  {% else %}
    <p>Чтобы оставить комментарий, пожалуйста, <a href="{% url 'users:login' %}">войдите</a>.</p>
  {% endif %}

  {% if comments %}
    {% for comment in comments %}
      <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
        <p><strong>{{ comment.author.username }}</strong> ({{ comment.created|date:"d.m.Y H:i" }}):</p>
        <p>{{ comment.text|linebreaksbr }}</p>
      </div>
    {% endfor %}
  {% else %}
    <p>Пока нет комментариев.</p>
  {% endif %}

  {% if concept.detail %}
    <h3>Дополнительная информация:</h3>
    <p>Ключевые технологии: {{ concept.detail.core_technologies }}</p>
    <p>Предварительные условия: {{ concept.detail.prerequisites }}</p>
    <p>Примерное время изучения: {{ concept.detail.estimated_learning_time }} часов</p>
  {% endif %}
{% endblock %}
